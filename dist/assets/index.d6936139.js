import{m as t,Z as i,a as s,D as e,h,k as o,u as a,b as r,c as n}from"./vendor.0a0cd6bc.js";!function(t=".",i="__import__"){try{self[i]=new Function("u","return import(u)")}catch(s){const e=new URL(t,location),h=t=>{URL.revokeObjectURL(t.src),t.remove()};self[i]=t=>new Promise(((s,o)=>{const a=new URL(t,e);if(self[i].moduleMap[a])return s(self[i].moduleMap[a]);const r=new Blob([`import * as m from '${a}';`,`${i}.moduleMap['${a}']=m;`],{type:"text/javascript"}),n=Object.assign(document.createElement("script"),{type:"module",src:URL.createObjectURL(r),onerror(){o(new Error(`Failed to import: ${t}`)),h(n)},onload(){s(self[i].moduleMap[a]),h(n)}});document.head.appendChild(n)})),self[i].moduleMap={}}}("/assets/");const l={collision:{collisionCategory:{body:16,arm:17,shot:16,wall:16},collisionGroup:{body:1,arm:2,shot:1,wall:1},collisionMask:{body:65537,arm:65537,wall:65537,shot:65537}},gravity:{scale:.00195}},A=l.collision;var c=0;class d{constructor(i,e,h,o,a,r,n){this.id=1e3+c,c++,this.dir=h,this.damage=o,this.speed=a,this.weapon=n,this.player=this.weapon.player,this.env=this.player.env,this.width=r*this.env.relToAbs/3,this.height=6,this.x=i+this.width/2,this.y=e-this.height,this.body=t.Bodies.rectangle(this.x,this.y,this.width,this.height,{label:"Shot",id:this.id,friction:0,angle:this.dir,collisionFilter:{group:A.collisionGroup.shot,category:A.collisionCategory.shot,mask:A.collisionMask.shot}}),this.texture=new s("ressources/assets/sprite/bullet.png",{rotation:this.dir}),t.Body.setInertia(this.body,1/0),this.env.addShot(this)}update(){let i=this.env.timescale;const s=this.speed*i;t.Body.translate(this.body,{x:Math.cos(this.dir)*s,y:Math.sin(this.dir)*s}),this.x=this.body.position.x,this.y=this.body.position.y,(this.x>this.env.mapWidth||this.x<-500||this.y>this.env.mapHeight||this.y<0)&&this.destroy()}destroy(){this.env.shots=this.env.shots.filter((t=>t.id!==this.id)),t.World.remove(this.env.world,this.body)}render(){e.rectSprite(this.x-this.width/2,this.y-this.height/2,this.width,this.height,this.texture)}}class y extends class{constructor(t){this.player=t,this.name="Unknown",this.fireRange=1/0,this.fireRate=5,this.spread=Math.PI/20,this.nbShoot=1,this.shootSpeed=30,this.shootDamage=20,this.maxAmmo=20,this.ammoSize=2,this.reloadTime=1e3,this.nbAmmo=this.maxAmmo,this.isReloading=!1,this.canShoot=!0,this.autofire=!1}shoot(s=!1){if(this.isReloading||!this.canShoot)return;if(s&&!this.autofire)return;if(0==this.nbAmmo)return this.reload(),null;let{x:e,y:h}=this.player.playerArm.vertices[2];this.recoil=this.shootDamage*this.nbShoot/175,t.Body.applyForce(this.player.body,this.player.pos,{x:-this.recoil*Math.cos(this.player.angle),y:-this.recoil*Math.sin(this.player.angle)});const o=new d(e,h,this.player.angle,this.shootDamage,this.shootSpeed,this.ammoSize,this);return this.nbAmmo-=1,this.canShoot=!1,new i(1e3/this.fireRate,(()=>{this.canShoot=!0})),s||(this.autofire=!0),this.autofire&&new i(1e3/this.fireRate,(()=>this.shoot(!0))),o}stopShoot(){this.autofire=!1}singleShoot(){this.shoot(),this.stopShoot()}reload(){this.isReloading=!0,new i(this.reloadTime,(()=>{this.nbAmmo=this.maxAmmo,this.isReloading=!1}))}}{constructor(t){super(t),this.name="AR",this.fireRange=1/0,this.fireRate=5,this.spread=Math.PI/20,this.nbShoot=1,this.shootSpeed=30,this.shootDamage=20,this.maxAmmo=10,this.ammoSize=2,this.reloadTime=800}}class p{constructor(t,i){this.event=t,this.callback=i,window.addEventListener(this.event,this.callback)}}class g{constructor(t,i){this.delay=t,this.callback=i,window.setTimeout(this.callback,this.delay)}}class u{constructor(t,i){this.id=i.particles.length+1,this.env=i,this.pos=new h(t.x,t.y),this.angle=Math.PI/2+Math.random()*Math.PI,this.velocity=new h(5*Math.random()*Math.cos(this.angle),5*Math.random()*Math.sin(this.angle)),this.color="red",this.opacity=255*Math.random(),this.radius=3,this.env.particles.push(this)}update(){this.velocity.y+=1,this.pos.x+=this.velocity.x*this.env.timescale,this.pos.y+=this.velocity.y*this.env.timescale}render(){e.circle(this.pos.x,this.pos.y,this.radius)}}class m{constructor(t,s,e,h){this.pos=s,this.lifeDuration=e,this.particles=[],this.env=h;for(let i=0;i<t;i++){let t=new u(this.pos,this.env);this.particles.push(t)}new i(this.lifeDuration*this.env.timescale,(()=>this.destroy()))}destroy(){const t=this.particles.map((t=>t.id));this.env.particles=this.env.particles.filter((i=>!t.includes(i.id)))}}var b={player_name:"Player 1",keybind:{move_forward:["D","RIGHT"],move_backward:["Q","LEFT"],jump:["Z","SPACE","UP"],crouch:["S","DOWN"],dash:"SHIFT",reload:"R"}};const w={ZERO:o.ZERO,ONE:o.ONE,TWO:o.TWO,THREE:o.THREE,FOUR:o.FOUR,FIVE:o.FIVE,SIX:o.SIX,SEVEN:o.SEVEN,EIGHT:o.EIGHT,NINE:o.NINE,A:o.A,B:o.B,C:o.C,D:o.D,E:o.E,F:o.F,G:o.G,H:o.H,I:o.I,J:o.J,K:o.K,L:o.L,M:o.M,N:o.N,O:o.O,P:o.P,Q:o.Q,R:o.R,S:o.S,T:o.T,U:o.U,V:o.V,W:o.W,X:o.X,Y:o.Y,Z:o.Z,ENTER:o.ENTER,SHIFT:o.SHIFT,ESC:o.ESC,SPACE:o.SPACE,LEFT:o.LEFT,UP:o.UP,RIGHT:o.RIGHT,DOWN:o.DOWN,BACKSPACE:o.BACKSPACE,DELETE:o.DELETE,TAB:o.TAB,TILDE:o.TILDE2},f=l.collision;function x(t,i,s){const h=s.map((t=>new a(t.x,t.y)));e.poly(h)}class v{constructor(i,e,o,a,r){this.name=i,this.pos=e,this.width=o,this.height=a,this.env=r,this.id=this.env.entities.length+1,this.velocity=new h(0,0),this.health=100,this.alive=this.health>0,this.groundForce=.04,this.airForce=.01,this.mass=5,this.jumpForce=.3,this.stoppingFriction=.7,this.onAir=!1,this.isMoving=!1,this.isCrouch=!1,this.createBody(),this.dir=this.env.cursorPosition.x>this.body.position.x?"left":"right",this.playerHeadTexture=new s("ressources/assets/sprite/player/player_head.png"),this.playerBodyTexture=new s("ressources/assets/sprite/player/player_body.png"),t.Body.setMass(this.body,this.mass)}createBody(){const i=1*this.height/3,s=2*this.height/3,e=1*this.height/3;this.crouchOffset=parseFloat((1.5*this.height/6).toFixed(2)),this.playerHead=t.Bodies.circle(this.pos.x,this.pos.y-i,this.width/2,{label:"PlayerCircle"}),this.playerBody=t.Bodies.rectangle(this.pos.x,this.pos.y,this.width,s/2,{label:"PlayerRect"}),this.insideLegs=t.Bodies.rectangle(this.pos.x,this.pos.y+e,this.width,s/2,{label:"PlayerRect"}),this.jumpSensor=t.Bodies.rectangle(this.pos.x,this.pos.y+this.height/2,this.width,4,{sleepThreshold:9e10,label:"PlayerRect",isSensor:!0}),this.playerLegs=t.Body.create({parts:[this.insideLegs,this.jumpSensor],label:"ComposedBody",restitution:.2}),this.playerArm=t.Bodies.rectangle(this.pos.x+this.width-5,this.playerBody.position.y,2*this.width/3,10,{label:"PlayerRect",inertia:1/0,sleepThreshold:1/0,collisionFilter:{group:f.collisionGroup.arm,category:f.collisionCategory.arm,mask:f.collisionMask.arm}});let h=[this.playerBody,this.playerHead,this.playerLegs,this.jumpSensor];this.idArray=h.concat([this.playerArm]).map((t=>t.id)),this.body=t.Body.create({parts:[this.playerBody,this.playerHead,this.playerLegs,this.jumpSensor],inertia:1/0,friction:.01,frictionAir:.01,frictionStatic:.25,restitution:.14,sleepThreshold:1/0,collisionFilter:{group:f.collisionGroup.body,category:f.collisionCategory.body,mask:f.collisionMask.body}}),this.armConstraint=t.Constraint.create({bodyA:this.body,pointA:{x:this.width/2-5,y:0},bodyB:this.playerArm,pointB:{x:-this.width/2,y:0},stiffness:1,length:0}),this.composite=t.Composite.create({label:"Player",bodies:[this.body,this.playerArm],constraints:[this.armConstraint]})}flipDirection(){this.dir="left"===this.dir?"right":"left";const i="left"===this.dir?1:-1;t.Composite.remove(this.composite,this.armConstraint),t.Body.setAngle(this.playerArm,0),this.armConstraint=t.Constraint.create({bodyA:this.body,pointA:{x:i*this.width/2-5*i,y:0},bodyB:this.playerArm,pointB:{x:-this.width/2,y:0},stiffness:1,length:0}),t.Composite.add(this.composite,this.armConstraint),t.Body.setAngle(this.playerArm,this.angle),t.Body.setInertia(this.body,1/0),t.Body.setInertia(this.playerArm,1/0),this.playerHeadTexture.scale=new h(i,1),this.playerBodyTexture.scale=new h(i,1)}distTo(t){const i=this.pos.x-t.pos.x,s=this.pos.y-t.pos.y;return Math.sqrt(i**2+s**2)}getCloserPlayer(){return this.env.entities.sort(((t,i)=>this.distTo(t)-this.distTo(i)))[1]}hitBy(t,i){this.health-=t.damage,this.health<0&&(this.health=0),this.env.removeShot(t),new m(5,this.body.position,200,this.env)}checkDeath(){this.alive=!(this.health<=0||this.pos.y>this.env.mapHeight),this.alive||console.log(`${this.name} vient de mourir`)}render(){this.alive&&(e.rectFromPoints(this.body.bounds.min.x,this.body.bounds.min.y,this.body.bounds.max.x,this.body.bounds.max.y,{strokeStyle:"red"}),this.composite.bodies.forEach((t=>{t.parts.forEach((t=>{switch(t.label){case"PlayerRect":x(t.position.x,t.position.y,t.vertices);break;case"ComposedBody":x(t.position.x,t.position.y,t.vertices),e.rectSprite(t.position.x-this.width/2,t.position.y-this.height/2,this.width,2*this.height/3,this.playerBodyTexture);break;case"PlayerCircle":e.circle(t.position.x,t.position.y,t.circleRadius),e.circleSprite(t.position.x,t.position.y,t.circleRadius,this.playerHeadTexture)}}))})))}update(){this.alive&&this.env&&(this.onAir=0===this.env.objects.filter((i=>{if(!i)return;let s=t.SAT.collides(i.body,this.jumpSensor);return s.collided&&0===s.axisNumber})).length,this.onAir=!1,this.isMoving&&!(this.body.speed>12)||this.onAir?this.isMoving=!1:t.Body.setVelocity(this.body,{x:this.body.velocity.x*this.stoppingFriction,y:this.body.velocity.y*this.stoppingFriction}),this.pos=new h(this.body.position.x,this.body.position.y),this.checkDeath())}}class I extends v{constructor(t,i,s,e,o,a,r=!1){super(t,new h(i+e/2,s+o/2),e,o,a),this.cameraFocus=!1,this.cameraFocus=r,this.nbJump=0,this.wallSlide=!1,this.wallSlideSide="no-collision",this.weapon=new y(this),this.env.events.push(new p("mousedown",(()=>this.weapon.shoot()))),this.env.events.push(new p("mouseup",(()=>this.weapon.stopShoot()))),this.env.addEntity(this),this.initSetup(b)}initSetup(t){Object.keys(t.keybind).forEach((i=>{let s=t.keybind[i];"string"==typeof s?this.assignKey(i,s):"object"==typeof s&&s.forEach((t=>{this.assignKey(i,t)}))})),o.run((()=>o.tick()))}assignKey(t,i){let s=w[i];switch(t){case"move_forward":s.down((()=>this.move("right")));break;case"move_backward":s.down((()=>this.move("left")));break;case"jump":s.press((()=>this.jump()));break;case"crouch":s.down((()=>this.crouch())),s.up((()=>this.uncrouch()));break;case"dash":s.press((()=>console.log("grappeln")));break;case"reload":s.press((()=>this.weapon.reload()))}o.F.press((()=>this.slowMotion())),o.E.press((()=>this.autoShoot()))}move(t){if(this.body.speed<=12&&"jump"!==this.wallSlideSide){const i="left"===t?-1:1,s=this.onAir?this.airForce:this.groundForce;this.body.force.x=i*s,this.isMoving=!0}}jump(){if(!this.onAir||this.nbJump<2){const i=1===this.nbJump?.8*this.jumpForce:this.jumpForce;let s=0;this.wallSlide&&"no-collision"!==this.wallSlideSide&&(s="left"===this.wallSlideSide?4*-this.groundForce:4*this.groundForce,this.wallSlideSide="jump"),t.Body.applyForce(this.body,this.pos,{x:s,y:.12*i*this.mass}),this.body.force.y=-i,t.Body.setVelocity(this.body,{x:this.body.velocity.x,y:0}),this.nbJump++}}crouch(){this.isCrouch||(t.Body.translate(this.playerLegs,{x:0,y:-this.crouchOffset}),t.Body.set(this.body,"airFriction",.01/3),this.isCrouch=!0)}uncrouch(){this.isCrouch&&(t.Body.translate(this.playerLegs,{x:0,y:this.crouchOffset}),t.Body.set(this.body,"airFriction",.01),this.isCrouch=!1)}autoShoot(){const t=this.getCloserPlayer();t&&(this.lookAt(t.playerHead.position),this.weapon.singleShoot())}slowMotion(){1===this.env.timescale&&(this.env.changeTimeScale(.33),new g(600,(()=>this.env.changeTimeScale(1))))}lookAt(i){this.angle=Math.atan2(i.y-this.pos.y,i.x-this.pos.x);let s=new h(0,0);"right"===this.dir?s={x:this.body.position.x+this.width/2-5,y:this.body.position.y}:"left"===this.dir&&(s={x:this.body.position.x-this.width/2+5,y:this.body.position.y});const e=t.Vector.angle(s,i);t.Vector.angle(this.body.position,i),t.Body.rotate(this.playerArm,e-this.playerArm.angle,s);const o="left"===this.dir?-1:1;Math.cos(this.angle)*o>0&&this.flipDirection()}onGround(){this.nbJump=0}update(){if(!this.alive)return;if(!this.env)return;this.lookAt(this.env.cursorPosition),this.onAir=0===this.env.objects.filter((i=>{if(!i.body||!this.jumpSensor)return!1;let s=t.SAT.collides(i.body,this.jumpSensor);return s.collided&&0===s.axisNumber})).length;let i=0!==this.env.objects.filter((i=>{if(!i.body)return!1;let s=t.SAT.collides(i.body,this.jumpSensor);return"position"in i.body?!(!s.collided||1!==s.axisNumber)&&(this.wallSlideSide=s.bodyA.position.x>s.bodyB.position.x?"left":"right",!0):console.log(i)})).length&&this.body.velocity.y>0;this.wallSlide=i&&this.isMoving,this.onAir||this.onGround(),this.wallSlide?this.nbJump=1:this.wallSlideSide="no-collision",this.isMoving&&!(this.body.speed>12)||this.onAir?this.isMoving=!1:t.Body.setVelocity(this.body,{x:this.body.velocity.x*this.stoppingFriction,y:this.body.velocity.y*this.stoppingFriction}),this.wallSlide&&0==this.body.friction&&console.log("FrictionError"),this.pos=new h(this.body.position.x,this.body.position.y),this.checkDeath()}render(){super.render();[`motion: ${this.body.motion.toFixed(3)}`,`speed: ${this.body.speed.toFixed(3)}`,`velocity: {x: ${this.body.velocity.x.toFixed(0)}, y: ${this.body.velocity.y.toFixed(0)}}`,`position: {x: ${this.body.position.x.toFixed(0)}, y: ${this.body.position.y.toFixed(0)}}`,`angle: ${(180*this.angle/Math.PI).toFixed(2)}Â°`,`mass: ${this.body.mass}`,`inertia: ${this.body.inertia}`,`onAir: ${this.onAir}`,`isCrouching: ${this.isCrouch}`,`isMoving: ${this.isMoving}`,`wallSlide: ${this.wallSlide}`,`wallSlideSide: ${this.wallSlideSide}`,`frictionStatic: ${this.body.frictionStatic}`,`friction: ${this.body.friction.toFixed(4)}`,`direction: ${this.dir}`,`camera : ${this.env.camera.x.toFixed(2)}, ${this.env.camera.y.toFixed(2)}`,`number of bodies: ${t.Composite.allBodies(this.env.world).length}`].forEach(((t,i)=>e.text(t,10,15*(i+1))))}}class E{constructor(t,i,s,e,h){this.zoom=1,this.focus=void 0,this.env=h,this.x=t,this.y=i,this.zoom=1,this.width=s/this.zoom,this.height=e/this.zoom,this.safeZoneSize=this.width/5,this.safeZone={x1:this.width/2-this.safeZoneSize/2,x2:this.width/2+this.safeZoneSize/2,y1:this.height,y2:this.height/3},this.follow_x=!0,this.follow_y=!0,r.onKeyDown("KeyC",(()=>this.y+=4)),r.onKeyDown("KeyV",(()=>this.y-=4))}setFocus(t){this.focus=t}include(t){return!0}update(){if(this.focus){let t=this.focus.pos.x,i=this.focus.pos.y;if(this.follow_x){let i=0;t<=this.x+this.safeZone.x1?(i=t-this.x-this.safeZone.x1,this.x+=i):t>=this.x+this.safeZone.x2&&(i=t-this.x-this.safeZone.x2,this.x+=i)}if(this.follow_y){let t=0;i<=this.safeZone.y2?(t=i-this.y-this.safeZone.y2,this.y+=t):i>this.y+this.safeZone.y1&&(t=i-this.y-this.safeZone.y1,this.y+=t)}}}}const C=l.gravity.scale;class S{constructor(i,s){this.width=0,this.height=0,this.tick=0,this.timescale=1,this.framerate=60,this.width=i.clientWidth,this.height=i.clientHeight,this.map=s,this.engine=t.Engine.create({enableSleeping:!0}),this.engineRunner=t.Runner.create({}),this.world=this.engine.world,this.world.gravity.scale=0,this.entities=[],this.shots=[],this.objects=[],this.particles=[],this.events=[],this.cursorPosition=new h(0,0),this.camera=new E(0,0,this.width,this.height,this),this.relToAbs=Math.min(this.camera.width/s.tileWidth,this.camera.height/s.tileWidth),this.mapWidth=this.map.dimensions.width*this.relToAbs,this.mapHeight=this.map.dimensions.height*this.relToAbs,this.events.push(new p("mousemove",(t=>this.updateCursorPosition(t)))),this.initMatterEngine(),this.initMap()}initMatterEngine(){this.world.gravity.scale=0,t.Events.on(this.engine,"beforeUpdate",(i=>{t.Composite.allBodies(this.engine.world).forEach((t=>{t.isStatic||t.isSleeping||"Shot"===t.label||(t.force.y+=t.mass*C)}))})),t.Events.on(this.engine,"collisionStart",(t=>{const i=t.pairs.filter((t=>"Shot"===t.bodyA.label||"Shot"===t.bodyB.label));if(i.length>0)for(let s of i){const t="Shot"===s.bodyA.label?s.bodyA:s.bodyB,i=t===s.bodyA?s.bodyB:s.bodyA;if("Wall"===i.label){const i=this.shots.filter((i=>i.id===t.id))[0];i&&i.destroy()}else"PlayerRect"!=i.label&&"PlayerCircle"!=i.label||this.collision(t,i)}}))}initMap(){this.objects=[],t.World.clear(this.world,!1),this.map.init(this),this.objects.forEach((t=>{t.tiles.forEach((t=>{t.defineTexture()}))}))}addEntity(i){this.entities.push(i),t.World.add(this.world,i.composite),i instanceof I&&i.cameraFocus&&this.camera.setFocus(i)}addObject(i){this.objects.push(i),t.World.add(this.world,i.body)}addShot(i){this.shots.push(i),t.World.add(this.world,i.body)}removeShot(i){this.shots=this.shots.filter((t=>t.id===i.id)),t.World.remove(this.world,i.body)}collision(t,i){const s=this.shots.filter((i=>i.id===t.id))[0];if(s&&s.player.idArray.includes(i.id))return!1;const e=this.entities.filter((t=>t.idArray.includes(i.id)))[0];return e&&s&&e.hitBy(s,i),null!=e}changeTimeScale(t){this.timescale=t,this.engine.timing.timeScale=this.timescale}updateCursorPosition(t){this.cursorPosition=new h(t.clientX+this.camera.x,t.clientY+this.camera.y)}update(){t.Runner.tick(this.engineRunner,this.engine,1/this.framerate),this.objects.forEach((t=>t.update())),this.shots.forEach((t=>t.update())),this.particles.forEach((t=>t.update())),this.entities.forEach((t=>t.update())),this.camera.update(),this.render(),this.tick++}render(){e.beginFrame(),e.setOffset(0,0),e.line(this.camera.safeZone.x1,this.camera.height-25,this.camera.safeZone.x2,this.camera.height-25),e.setOffset(-this.camera.x,-this.camera.y),this.objects.forEach((t=>t.render())),this.shots.forEach((t=>t.render())),this.particles.forEach((t=>t.render())),this.entities.forEach((t=>t.render())),e.endFrame()}}class B{constructor(t,i){this.rows=i,this.cols=t,this.cells=[],this.createCells(),this.defineNeighboors()}createCells(){for(let t=0;t<this.cols;t++)for(let i=0;i<this.rows;i++)this.cells.push(new T(i,t))}getCell(t,i){let s=this.cells.filter((s=>s.x===t&&s.y===i));if(0!==s.length)return s[0];console.error(`La cellule (x: ${t}, y: ${i}) n'existe pas`)}updateCell(t){this.cells.includes(t)&&(console.log(t),this.defineNeighboors(),this.cells[this.cells.indexOf(t)]=t)}defineNeighboors(){this.cells.forEach((t=>{t.neighboor.top=t.y>=1?this.cells.filter((i=>i.x<=t.x&&i.x+i.width>t.x&&i.y===t.y-t.height))[0]:null,t.neighboor.bottom=t.y<=this.rows-1?this.cells.filter((i=>i.x<=t.x&&i.x+i.width>t.x&&i.y===t.y+t.height))[0]:null,t.neighboor.left=t.x>=1?this.cells.filter((i=>i.y<=t.y&&i.y+i.height>t.y&&i.x===t.x-t.width))[0]:null,t.neighboor.right=t.x<=this.rows-1?this.cells.filter((i=>i.y<=t.y&&i.y+i.height>t.y&&i.x===t.x+t.width))[0]:null}))}}class T{constructor(t,i,s=1,e=1){this.x=t,this.y=i,this.width=s,this.height=e,this.neighboor={},this.active=!1}toggleActive(t){this.active=t||!this.active}}var R="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAAUGVYSWZNTQAqAAAACAACARIAAwAAAAEAAQAAh2kABAAAAAEAAAAmAAAAAAADoAEAAwAAAAEAAQAAoAIABAAAAAEAAAAgoAMABAAAAAEAAAAgAAAAAL5bTO0AAAIwaVRYdFhNTDpjb20uYWRvYmUueG1wAAAAAAA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJYTVAgQ29yZSA1LjQuMCI+CiAgIDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+CiAgICAgIDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiCiAgICAgICAgICAgIHhtbG5zOnRpZmY9Imh0dHA6Ly9ucy5hZG9iZS5jb20vdGlmZi8xLjAvIgogICAgICAgICAgICB4bWxuczpleGlmPSJodHRwOi8vbnMuYWRvYmUuY29tL2V4aWYvMS4wLyI+CiAgICAgICAgIDx0aWZmOk9yaWVudGF0aW9uPjE8L3RpZmY6T3JpZW50YXRpb24+CiAgICAgICAgIDxleGlmOkNvbG9yU3BhY2U+MTwvZXhpZjpDb2xvclNwYWNlPgogICAgICAgICA8ZXhpZjpQaXhlbFhEaW1lbnNpb24+MzI8L2V4aWY6UGl4ZWxYRGltZW5zaW9uPgogICAgICAgICA8ZXhpZjpQaXhlbFlEaW1lbnNpb24+MzI8L2V4aWY6UGl4ZWxZRGltZW5zaW9uPgogICAgICA8L3JkZjpEZXNjcmlwdGlvbj4KICAgPC9yZGY6UkRGPgo8L3g6eG1wbWV0YT4K9GTeTwAAAb5JREFUWAntkqFuQkEQRedVgSCgAEWQBIPBIAkOHAokkt/hB5A4kHwCGkP4BFCAw73umXY2y8trmzShVOwkMLs7M/fevfsSEUnd72Xx9jLmT+L/JWA2m/29IY6UbyAdj8eaWfOzc9v/lLPz1m84lu08yB+EjUYjl9QGe71emiSJiiuXy+l8PvdCrQdQamCx5pw9axNo2QS8uSa3Ful2u1IqlcQNiJ3VajU5HA7S6XRkt9tJoVDQ3tvtprler8vxeJTlcinValXopzYYDLTOH3vw1uv1Q6bGuf8IIV4sFuIUKiDF8/ks7XZb9vu9VCoVmUwmXtz9fpfT6SStVgssGY1GMhwOtY4g5i1TN/GsTRT1xO2xSm8CmA0Bzg3DgHS1Wim41QFDvM1ZZi7suVwu0mw2Pdz1etVL6ROwsZvQAYiRA8Ke4Bb9fl/XxWJRM+QE59ZHRux2u/U9CA0DR4nE3Z6P5FcB0XQ6fbA3CwQx70/gtAWz7HMFoD58MxvKy/YEeTUjydZwHA5c9h9haBHvTND4XUBgAWA2whuHtc1m458414Gw+dlr78Czib7CjwKiA9GB6EB0IDoQHYgOvNyBd8ecCZGxvGNgAAAAAElFTkSuQmCC",P="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAADAklEQVRYR81WO09yQRAdaHgkBGyESh4VsRGMjaWx8VFBBXSU/h0a6Cix0kqgIZRY2NgYOgkV2oCNSKPmTDJmvOzl7iUm37fNfWR358yZM48AEX3RP1yB/xZANpul5+fnP+UmGAzS5+fnrzuNDESjUXp/f6ezszPq9/t/AmJnZ4fm8znJUy51DUG9Xqd2u21tHPvH4zHvH41GP+eKxSJ7/fj4aLxrDUCpVKK3tzdKp9MM4Pj4mPL5PL9nMhk6OTmhTqdD1WqVhsMhTSYTisfjP5fjf6vV4u+rqytqNpu0yZmNIpSD+oJEIkGLxYIN4H+v16PZbMbfyWSSwd7f3/N3rVbzZHENAC69ublhFvAuC9/aU/mfy+V4f6FQYMMACBCywByAvby82IVAPMMTh8/Pz9lLzYaNMMBKKpXirU9PT7S/v29kwzMEuODj44PC4bCN3V+eC+iDgwN7EeKGvb09Oj09ZcR+PXeivL29Zc1AzDo7NqYhYi0akFTUerClQpi7vr5mFr++1qu+awggnIuLC7YlTNgaxj6kJ9LUq56sASiXy6zq3d1dury8ZOPIfdSAbfQgDAqrTieMDGjU21APIwjhcrnkTBABoyhZA0BZRT5L/iOGq9WKz5vqgb5YhwzvACHFygoANskhYcAmIwAWKxQKsdcCXpwx9RZjCFDDJd5AHolEPL12E6jOImsAWjB+NKALls6Cu7s7en19JRG4ButZCZ1ZYJuKWgfdbtdfLwgEAhzDSqWyVRmW2oGnZJSvNJSyic6G+WCb5RTtYDCg6XRql4bYJQ1k216g9bBpsnItRNJCAUa3Vi82tOe6leuwWIlQhghnFqCzITSblnN4AShoAFngZMM4Eenc9eO9gBIWNBC3MHhOxVoDiCsGUq/aAGOHh4fsNWYAnIP3+PZkQLxwUuZl1EYbpj2/GNDexmIxajQant7aGjZVQZw1zgMPDw90dHTElEkjEUNu07GoHHVDi1T2+9aAGAQrNsqX/RCtTNFyzlcdcBaebcYx02zgBuIb+3zxEHiGomoAAAAASUVORK5CYIIA",G="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAACaklEQVRYhe1WvarqQBCe3GthCok2JjbBRlARRFBU8Am0MpWWKfMW9xl8AUsLQUsfwcbCSizVSiu10kY8zHBm2WTjOaeIOc39IOzv7Dd/O1kNAJ7wi/jzm+SI/wq8VMB1XWXuKziOE7rK53x13pM/13Wf8liea7fbT03TqG8YxtPzPLEuy+GabdtiDcfYdxzH10ofvCQ1TfPZbDbFvK7roo8KWJZFiuE4m83Sfln+J60SAtu2YTwek8tOpxOUy2WaT6fTMBgMhCvv9zscj0coFos07vV60O12aZ3luUUkk0nBcb1exXpoHQg7BNvhcAiTyYTGSG5ZFh1mGIayHyHvOZ/PkM/nBcflciGj/gLAv6AC6/VaHJLL5WA6ndI4kUhAJpMhwcfjQVaxZTg/n8+FfKlUonGtVqM9+/2elGGwnOKBTqcDhUIh1KIg2Cuye4NA62ezmXIT+FxFAcyBw+EgyIOCYQQYgjC8Uh7djzmEHlGSEMkZ/X5fEZbBCsJnUgYRRo7A0HA4fB5gqyuVCjQajZcWRAklBD91fVRIhJ0TBzFDyQG0frFY+OLLfXkuKigh8DyPWq50uq6/zPIooCiAZHi1IKZQKCGQydHlu91OEYoSShJqmiYq23dVLgooHmi1WnC73ahYvJscoSiwXC6hWq1SuYQ3Zb4MJQkx9pvNRrwD+JcamwII0zTpMRK8BfwPjxK+EDAhk6P1MqImR/gUkP8B2EfX8xwWplgqIXwWI3xmx/FTEnVAfv2kUikYjUaxVEKfB9Dq1WoF9XqdvLDdbsWrF755/USiQBDogXdkvozQW4Ath+Sd5AAAH8hAa64K9tj9AAAAAElFTkSuQmCC",F="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAFBlWElmTU0AKgAAAAgAAgESAAMAAAABAAEAAIdpAAQAAAABAAAAJgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAAC+W0ztAAABWWlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iWE1QIENvcmUgNS40LjAiPgogICA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPgogICAgICA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIgogICAgICAgICAgICB4bWxuczp0aWZmPSJodHRwOi8vbnMuYWRvYmUuY29tL3RpZmYvMS4wLyI+CiAgICAgICAgIDx0aWZmOk9yaWVudGF0aW9uPjE8L3RpZmY6T3JpZW50YXRpb24+CiAgICAgIDwvcmRmOkRlc2NyaXB0aW9uPgogICA8L3JkZjpSREY+CjwveDp4bXBtZXRhPgpMwidZAAADBUlEQVRYCe2WP0+iQRDGB85ESSBKg9IQS7ExJiaG0tggdlZaUtL4Ge4z8AUsKOy0tLS01cZYWmqlVtC9t7+RZ2/ljyR38bjCSV5md+eZmWdn33eZnJll4Zmb5OeWeZj4/yLQbrf/fUFCUt6B7OjoyDVjHq1rPkuP+guvONJaT/R7wlqtNjGpHBuNRpbL5Zzc8vJy1ul0IlFhCIqNWIxZZ85YBKVFIB9AYWy2s7NjpVLJgoNpbXV11e7v721ra8tubm5saWnJsW9vb67X1tbs4eHBzs7OrFKpGHhs+/v7bueHOfEuLi4+aGysx5eQxN1u1wJDD4jx+fnZNjc37e7uzlZWVuz4+DiSGwwG9vT0ZBsbG8Syw8NDa7VabocQ/tLYRZ6xSGHPhTml8p0QTE4EZ4epkPT8/NyDy04wyMtPGr8U8/LyYuvr6zHc6+urb8qPgIl2AoIgSk4Q5gi72Nvb83GhUHBNcoR14dCQvbq6ihiIpkJFkVzYPS/JHwmJTk5OPpR3NBCJOX+ESkvwZT6RAOzTM5PTJK0jmGRTklEbFScHVY4vYVoizhkB+JmQQELAUUl3nNouLy/jEU+sQAr+6nGswFcnmhb/m8B3BWIF0k9q2gujdX1yfLqz/PQpp7j0k/fPkOuWi0fXoxKhcZz2PX92CaUxGE+73LwC3NlpcpLykGBacoIuLi7OrAA4ZNrN+mN7e/tneN5Rw998Pm/NZtOdIFKv163X69nt7a0/5XLZCS8sLBi+ECXB4+Nj3Ah+1WrVisWiR2WOv3JxNPh4BXROYsE/nM7p4ODAgaoE+vr62qHC9Pt9n7Ou9wNc+o8qf4A0MVQcUoi3TmqVAjALzHyNsezSrE1aT+0h+Jif7GP6s2Bj4EA2tF1ZaL88AX1i2GXsD8GHPsFtoY3Ldnd3Ha84obLZ6elp7A+Hud+bUkCqgjQOIkijyRycAspGgyobjSvEhBFeGh81rcO13wRSEGMl0Lq0CGo+S4/Gkf9wfZzArIB/Yx8l401pCDg3iVfxvBjMncAvw2lIXdl9HdEAAAAASUVORK5CYII=";const k=new s(R),O=new s(R,{rotation:Math.PI}),W=new s(R,{rotation:-Math.PI/2}),M=new s(R,{rotation:Math.PI/2}),Z=new s("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABC0lEQVRYR82XuxKFIAxEoaOTX7Tk76Gj8w6Fjo9ANgmO19IEcrJLGPXrum5O+MQYXc5ZuIpO9xqAGZX3Jj4D2Jv4X4BSiluW5aI29a4ltLwW0zwPBfai2g17ED3I6RZI1VAD9OyQ2gABSLuiIHrAEIC0K0n+FACLQgdArdWFECTw0IhyGw4V0HQ2WkPFRBbMOvlnVUQAlJyoSvAU3Dd8o+upCnCHjIubLRgVQOy5ALwtNwXrU0pbuwPQA4Z0xcluOgOcSqP48B6w3oSSrk0KaAv11nWnYLbXYgBrp9xZUX0Vc6pwcXIMv/oxUSmA2oLK3ybv1asYAT4ANP4hBc455g+Se0FU6hHo5xb8AJfrvEk3ziJWAAAAAElFTkSuQmCC"),D=new s(F),L=new s(F,{rotation:Math.PI/2}),N=new s(P),j=new s(P,{rotation:Math.PI}),U=new s(P,{rotation:Math.PI/2}),Y=new s(P,{rotation:-Math.PI/2}),H=new s(G),z=new s(G,{rotation:Math.PI/2}),V=new s(G,{rotation:-Math.PI/2}),Q=new s(G,{rotation:Math.PI}),J=new s("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAACnElEQVRYhe1Wu6oiQRAt3UCNFIOZiQYTQUR8BCKCiRiZmpkIE/oX+yeCPyEIIn6Bj0AMxUgNfICggjhL9VJDa1ePyrL3JvdA0zNd3X1OVb8qAAAufCOC30mO+BGgFeA4jtLmh0ajwVrfmcf1K47jePZAICDqaDTqttttzy73QZtt28pYXdFGAGGaJsznc8jlcuI/HA6L+ng8itqyLFgsFtDpdMAwDNEfbbVaTZnLLxoP6p5V038sFnvwlqs5O5ZsNquNAHsPoNL1eg29Xk98o4dUy3aMAHocjUYf+pCncp/9fg/D4VDxnhWgE4JYLpeQSCQ8YgK2cwSIVqsF3W5XadcKqFQqkEwmWa9kYHuz2fT2BgcUheJ0YDfharVSws4B7dfrlbH8BY6tVqsQj8chGGSp9AKy2SwcDgfWc5mAcLlcFDtht9vB/X5X2hHKEpDXmUwGisWiNvzvgkTati0ceylAFgE+Z/dfxMhgl4CIPyUnApkIv8fjMUuOYCOAyOfzMJlMPBGvTsQnAl8K+B9h152oXwDw+7kRd+1oNBIRKBQKyqBPyJH4drtBv98X3zinDHYP0G7VqaYjh7chZ5fJ8SjTHcD1ZQXgALw8dJBvPr/lQsJYLAaz2UwcQw6sALw0cBnwGvUjCIVCrFeyOIqETgC7CeHFA4LXKz5IBHqY6KEi7+v1ungN/USyEUCC0+kklOMk8p2ANb16lJicz2dRY7tMRuQ0hw5KkvCcRMhJBpd0PNsxefFLbp7KexkR1aZpuoZhiO9yuexaluXlh1gikYioc7mcWyqVRH+G1CvKEujWazAYiHXebDaw3W5FSFOplEhYEJSc0BGdTqeQTqdF/1dQVOmiQaXRaChtfkU3jzYn/EooS/Aj4EsBAH8A6Nf8/nuxSYAAAAAASUVORK5CYII=");new s("/assets/player_body.7e35df12.png"),new s("/assets/player_head.2b71bf7b.png",{offset:new h(-7,0)}),new s("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA8AAAAFCAYAAACaTbYsAAAARElEQVQYlWP8//8/A0Mw/38GQmDtR0Z0FSxgjWkEtaJaADWI8X8QH0SzQi5ujQ8mI9izkG3GpgAbQNKEsJlcPzMwMAAAkpAZ14XtTasAAAAASUVORK5CYII=",{scale:new h(2,2)});let X={UP:k,DOWN:O,LEFT:W,RIGHT:M,MIDDLE:Z,HPIPE:D,VPIPE:L,TOP_END:N,BOTTOM_END:j,RIGHT_END:U,LEFT_END:Y,UP_LEFT:H,UP_RIGHT:z,DOWN_LEFT:V,DOWN_RIGHT:Q,CUBE:J};class K extends T{constructor(t,i,s){super(t,i,1,1);const e=s.map.grid.getCell(this.x,this.y);this.neighboor=e.neighboor,this.texture=null}defineTexture(){let t=this.neighboor,i=["up","down","right","left","middle"];switch(t.top&&t.top.active&&(i=i.filter((t=>!t.includes("up")))),t.bottom&&t.bottom.active&&(i=i.filter((t=>!t.includes("down")))),t.right&&t.right.active&&(i=i.filter((t=>!t.includes("right")))),t.left&&t.left.active&&(i=i.filter((t=>!t.includes("left")))),1===i.length?this.side="MIDDLE":(i=i.filter((t=>!t.includes("middle"))),this.side=i.join("-").toUpperCase()),this.side){case"UP":this.texture=X.UP;break;case"DOWN":this.texture=X.DOWN;break;case"LEFT":this.texture=X.LEFT;break;case"RIGHT":this.texture=X.RIGHT;break;case"MIDDLE":this.texture=X.MIDDLE;break;case"UP-DOWN":this.texture=X.HPIPE;break;case"RIGHT-LEFT":this.texture=X.VPIPE;break;case"UP-DOWN-LEFT":this.texture=X.LEFT_END;break;case"UP-DOWN-RIGHT":this.texture=X.RIGHT_END;break;case"UP-RIGHT-LEFT":this.texture=X.TOP_END;break;case"DOWN-RIGHT-LEFT":this.texture=X.BOTTOM_END;break;case"UP-DOWN-RIGHT-LEFT":this.texture=X.CUBE;break;case"UP-LEFT":this.texture=X.UP_LEFT;break;case"UP-RIGHT":this.texture=X.UP_RIGHT;break;case"DOWN-LEFT":this.texture=X.DOWN_LEFT;break;case"DOWN-RIGHT":this.texture=X.DOWN_RIGHT}this.texture||console.error(`Missing texture : ${this.side}`)}}class q{constructor(i,s,e,o,a,r,n,l){switch(this.type=s,this.map=i,this.isStatic=l.isStatic,this.env=n,this.width=a*this.env.relToAbs,this.height=r*this.env.relToAbs,this.tiles=[],this.pos=new h(e*this.env.relToAbs,o*this.env.relToAbs),this.type){case"rect":this.body=t.Bodies.rectangle(this.pos.x+this.width/2,this.pos.y+this.height/2,this.width,this.height,l);for(let t=0;t<a;t++)for(let i=0;i<r;i++){let s=this.map.grid.getCell(e+t,o+i);s.toggleActive(!0),this.tiles.push(new K(s.x,s.y,this))}this.id=this.body.id;break;case"circle":this.body=t.Bodies.circle(this.pos.x,this.pos.y,(this.width+this.height)/2,Object.assign({isStatic:this.isStatic},l)),this.id=this.body.id}this.env.addObject(this)}render(){this.tiles.forEach((t=>{e.rect(t.x*this.env.relToAbs,t.y*this.env.relToAbs,t.width*this.env.relToAbs,t.height*this.env.relToAbs,{lineWidth:1}),e.rectSprite(t.x*this.env.relToAbs,t.y*this.env.relToAbs,t.width*this.env.relToAbs,t.height*this.env.relToAbs,t.texture)}))}update(){}}const _=l.collision;class $ extends v{constructor(t,i,s,e,o,a){super(t,new h(i+e/2,s+o/2),e,o,a),this.env.addEntity(this)}}var tt={name:"Map 1",dimensions:{width:"100",height:"25"},grid:{width:"36",height:"18"},objects:["format type       x     y     w    h    inertie     name","       rect       0    17    90    2     static     floor","       rect       2    10     2    1     static     plateform-1","       rect      22    10     1    1     static     plateform-2","       rect      12     3     1   11     static     vertical-2","       rect      18     3     1   11     static     vertical-1","       rect       6     3     6    1     static     horizontal-1","       rect      19     3     6    1     static     horizontal-2","       rect       0    15     1    2     static     left-block","       rect      29    15     1    2     static     right-block","       rect      40    10     2    1     static     plateform-3","       rect      44     8     3    1     static     plateform-4","       rect      52     4     1   10     static     vertical-3","       rect      56     4     1   10     static     vertical-4"]};const it=new n("RunAndGun"),st=e.create(),et=new class{constructor(t){this.file=t,this.tileWidth=Math.min(parseInt(this.file.grid.width),parseInt(this.file.grid.height)),this.objects=this.file.objects,this.dimensions={width:parseInt(this.file.dimensions.width),height:parseInt(this.file.dimensions.height)},this.grid=new B(this.dimensions.height,this.dimensions.width)}init(t){for(let i of this.objects){let[s,e,h,o,a,...r]=i.trimLeft().split(/\s+/);if("format"!=s){let[i,n,l,A]=[parseInt(e),parseInt(h),parseInt(o),parseInt(a)];const c={label:"Wall",friction:.001,mass:5,isStatic:r.includes("static"),frictionStatic:.1,collisionFilter:{group:_.collisionGroup.wall,category:_.collisionCategory.wall,mask:_.collisionMask.wall}};new q(this,s,i,n,l,A,t,c)}}this.grid.defineNeighboors()}}(tt);window.onload=()=>{const t=new S(st,et),i=new I("Dorian",300,200,50,80,t,!0),s=new $("Bad Guy",200,200,40,88,t);new $("Bad Guy 2 ",2200,200,40,88,t),window.env=t,window.player=i,window.enemy1=s,st.focus(),it.setMainLoop((()=>t.update())),it.start()};
